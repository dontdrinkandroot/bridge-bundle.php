#!/bin/sh
git pull \
&& pnpm install \
&& pnpm upgrade \
&& pnpm encore dev \
&& composer update dontdrinkandroot/* --prefer-source \
&& composer update --patch-only

if [ -n "$(git status --porcelain composer.lock)" ] || [ -n "$(git status --porcelain pnpm-lock.yaml)" ]; then
    if [ -n "$(git status --porcelain composer.lock)" ]; then
        git add composer.lock
    fi
    if [ -n "$(git status --porcelain pnpm-lock.yaml)" ]; then
        git add pnpm-lock.yaml
    fi
    if [ -n "$(git status --porcelain package.json)" ]; then
        git add package.json
    fi
    git commit -m "refactor: Updating dependencies"
fi
